[settings]
experimental = true
lockfile = true

[tools]
go = "latest"
hk = "latest"
pkl = "latest"
prettier = "latest"
"go:golang.org/x/pkgsite/cmd/pkgsite" = "latest"
"go:github.com/oapi-codegen/oapi-codegen/v2/cmd/oapi-codegen" = "latest"

[env]
_.file = '.env'
_.path = 'bin'

[tasks.setup]
run = [
  "mise install",
  "hk install",
  "mise lock",
]

[tasks.build]
run = "go build ./..."

[tasks.test]
run = "go test ./..."

[tasks.clean]
run = "go clean"

[tasks.check]
description = "Run all checks (linters, etc.)"
run = "hk run check"

[tasks.fix]
description = "Run all fixers (format, generate docs, etc.)"
run = "hk run fix"

[tasks.docs]
description = "Open local API documentation in browser"
run = "pkgsite -open ."

[tasks.generate]
description = "Run all code generation tasks"
run = [
    "rm -rf docs",
    "go run ./cmd/gen-docs",
    "prettier --log-level=warn --write docs/**/*.md",
    "go generate ./..."
]

[tasks.ci]
description = "Run all CI checks locally"
run = [
    "mise run generate",
    "mise run build",
    "mise run test",
    "mise run fix",
    "mise run check",
    "git diff --exit-code"
]
